<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solomon Instances Viewer</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 1200px;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        label {
            font-weight: 600;
            color: #333;
        }
        
        select, .file-input-wrapper {
            padding: 10px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            font-size: 14px;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }
        
        select:focus, .file-input-wrapper:hover {
            outline: none;
            border-color: #667eea;
        }
        
        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        
        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }
        
        .file-input-wrapper:hover {
            background: #f8f9fa;
        }
        
        .upload-zone {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-zone:hover {
            border-color: #5a67d8;
            background: #e6f3ff;
        }
        
        .upload-zone.dragover {
            border-color: #5a67d8;
            background: #e6f3ff;
            transform: scale(1.02);
        }
        
        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .instance-info {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 40px;
        }
        
        .plot-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        
        svg {
            border: 2px solid #ddd;
            border-radius: 10px;
            background: linear-gradient(145deg, #ffffff 0%, #f0f2f5 100%);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .depot {
            fill: #ff4757;
            stroke: #ff3742;
            stroke-width: 3;
            filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
        }
        
        .customer {
            fill: #3742fa;
            stroke: #2f3542;
            stroke-width: 1.5;
            transition: all 0.3s ease;
        }
        
        .customer:hover {
            fill: #ffa502;
            stroke: #ff9500;
            stroke-width: 2;
            cursor: pointer;
        }
        
        .depot-label {
            font-size: 14px;
            font-weight: bold;
            text-anchor: middle;
            fill: white;
            pointer-events: none;
        }
        
        .grid-line {
            stroke: #e1e5e9;
            stroke-width: 1;
            opacity: 0.5;
        }
        
        .axis {
            stroke: #636e72;
            stroke-width: 2;
        }
        
        .axis-label {
            font-size: 14px;
            font-weight: bold;
            fill: #636e72;
            text-anchor: middle;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-weight: 500;
        }
        
        .legend-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid white;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-top: 30px;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .stat-title {
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 5px;
            opacity: 0.9;
        }
        
        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            color: #ffeaa7;
        }
        
        .tooltip {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 1000;
            max-width: 250px;
        }
        
        .error {
            color: #d63031;
            text-align: center;
            padding: 20px;
            background: #fdcb6e;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .instructions {
            background: #e8f4f8;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 4px solid #667eea;
        }
        
        .instructions h3 {
            margin-top: 0;
            color: #333;
        }
        
        .instructions p {
            margin-bottom: 8px;
            color: #555;
        }
        
        .sample-data {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            margin-top: 10px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöõ Solomon Instances Interactive Viewer</h1>
        <div class="subtitle">Vehicle Routing Problem Benchmark Instances</div>
        
        <div class="instructions">
            <h3>üìÅ How to Use</h3>
            <p><strong>Option 1:</strong> Click the upload zone below to select a Solomon instance file</p>
            <p><strong>Option 2:</strong> Drag and drop a .txt or .csv file onto the upload zone</p>
            <p><strong>Customer Count:</strong> You can choose to display 25, 50, or all 100 customers from each instance</p>
            <p><strong>Data Format:</strong> Each line should contain: x_coord, y_coord, demand, ready_time, due_date, service_time</p>
            
            <div class="sample-data">
                <strong>Example data format:</strong><br>
                40.000000,50.000000,20.000000,1236.000000,0.000000,100.000000<br>
                45.000000,68.000000,1.000000,324.000000,269.000000,90.000000<br>
                45.000000,70.000000,3.000000,411.000000,366.000000,90.000000
            </div>
        </div>
        
        <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">üìÅ</div>
            <h3>Upload Solomon Instance File</h3>
            <p>Click here or drag & drop a .txt or .csv file</p>
            <div style="margin: 15px 0;">
                <label for="customerCountSelect" style="color: #667eea; font-weight: 600;">Customer Count:</label>
                <select id="customerCountSelect" style="margin-left: 10px; padding: 5px 10px; border: 2px solid #667eea; border-radius: 5px;">
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100" selected>100</option>
                </select>
            </div>
            <p style="font-size: 0.9em; color: #666;">Supports Solomon benchmark format</p>
            <input type="file" id="fileInput" accept=".txt,.csv" style="display: none;">
        </div>
        
        <div id="instanceInfo" class="instance-info" style="display: none;"></div>
        
        <div id="loadingMessage" class="loading" style="display: none;">
            Processing instance data...
        </div>
        
        <div id="errorMessage" class="error" style="display: none;"></div>
        
        <div id="plotContainer" class="plot-container" style="display: none;">
            <svg width="800" height="600" viewBox="0 0 800 600" id="plotSvg">
                <defs>
                    <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                        <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e1e5e9" stroke-width="1" opacity="0.3"/>
                    </pattern>
                </defs>
                <rect width="100%" height="100%" fill="url(#grid)" />
                
                <g transform="translate(60, 540)">
                    <line x1="0" y1="0" x2="680" y2="0" class="axis"/>
                    <line x1="0" y1="0" x2="0" y2="-480" class="axis"/>
                    <g id="gridLines"></g>
                    <g id="locations"></g>
                </g>
                
                <text x="400" y="580" class="axis-label">X Coordinate</text>
                <text x="30" y="300" class="axis-label" transform="rotate(-90, 30, 300)">Y Coordinate</text>
            </svg>
        </div>
        
        <div class="legend" id="legend" style="display: none;">
            <div class="legend-item">
                <div class="legend-circle" style="background: #ff4757;"></div>
                <span>Depot (Starting Point)</span>
            </div>
            <div class="legend-item">
                <div class="legend-circle" style="background: #3742fa;"></div>
                <span id="customerCount">Customers</span>
            </div>
        </div>
        
        <div class="stats" id="stats" style="display: none;">
            <div class="stat-card">
                <div class="stat-title">Total Locations</div>
                <div class="stat-value" id="totalLocations">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Customers</div>
                <div class="stat-value" id="customersCount">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Depot Location</div>
                <div class="stat-value" id="depotLocation">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Area Coverage</div>
                <div class="stat-value" id="areaCoverage">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Total Demand</div>
                <div class="stat-value" id="totalDemand">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">Time Span</div>
                <div class="stat-value" id="timeSpan">-</div>
            </div>
        </div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>

    <script>
        // DOM elements
        const uploadZone = document.getElementById('uploadZone');
        const fileInput = document.getElementById('fileInput');
        const customerCountSelect = document.getElementById('customerCountSelect');
        const instanceInfo = document.getElementById('instanceInfo');
        const loadingMessage = document.getElementById('loadingMessage');
        const errorMessage = document.getElementById('errorMessage');
        const plotContainer = document.getElementById('plotContainer');
        const legend = document.getElementById('legend');
        const stats = document.getElementById('stats');
        const tooltip = document.getElementById('tooltip');

        // Parse instance data
        function parseInstanceData(rawData, maxCustomers = 100) {
            const lines = rawData.trim().split('\n');
            // Always include depot (index 0) + the specified number of customers
            const linesToInclude = Math.min(lines.length, maxCustomers + 1);
            const selectedLines = lines.slice(0, linesToInclude);
            
            return selectedLines.map((line, index) => {
                const values = line.split(',').map(v => parseFloat(v.trim()));
                return {
                    id: index,
                    x: values[0],
                    y: values[1],
                    demand: values[2],
                    ready_time: values[3],
                    due_date: values[4],
                    service_time: values[5],
                    type: index === 0 ? 'depot' : 'customer'
                };
            });
        }

        // Clear previous visualization
        function clearVisualization() {
            document.getElementById('locations').innerHTML = '';
            document.getElementById('gridLines').innerHTML = '';
        }

        // Create visualization
        function createVisualization(locations, filename = '') {
            clearVisualization();

            const xCoords = locations.map(l => l.x);
            const yCoords = locations.map(l => l.y);
            const xMin = Math.min(...xCoords);
            const xMax = Math.max(...xCoords);
            const yMin = Math.min(...yCoords);
            const yMax = Math.max(...yCoords);

            const plotWidth = 680;
            const plotHeight = 480;
            const margin = 20;
            
            const xScale = (plotWidth - 2 * margin) / (xMax - xMin);
            const yScale = (plotHeight - 2 * margin) / (yMax - yMin);
            const scale = Math.min(xScale, yScale);

            function scaleX(x) {
                return margin + (x - xMin) * scale;
            }

            function scaleY(y) {
                return -(margin + (y - yMin) * scale);
            }

            const locationsGroup = document.getElementById('locations');

            locations.forEach(location => {
                const cx = scaleX(location.x);
                const cy = scaleY(location.y);

                if (location.type === 'depot') {
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', cx);
                    circle.setAttribute('cy', cy);
                    circle.setAttribute('r', '12');
                    circle.setAttribute('class', 'depot');
                    
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', cx);
                    text.setAttribute('y', cy + 4);
                    text.setAttribute('class', 'depot-label');
                    text.textContent = 'D';
                    
                    locationsGroup.appendChild(circle);
                    locationsGroup.appendChild(text);
                } else {
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', cx);
                    circle.setAttribute('cy', cy);
                    circle.setAttribute('r', '5');
                    circle.setAttribute('class', 'customer');
                    
                    circle.addEventListener('mouseenter', (e) => {
                        tooltip.style.opacity = '1';
                        tooltip.innerHTML = `
                            <strong>Customer ${location.id}</strong><br>
                            Position: (${location.x}, ${location.y})<br>
                            Demand: ${location.demand}<br>
                            Time Window: [${location.due_date}, ${location.ready_time}]<br>
                            Service Time: ${location.service_time}
                        `;
                    });
                    
                    circle.addEventListener('mousemove', (e) => {
                        tooltip.style.left = e.pageX + 10 + 'px';
                        tooltip.style.top = e.pageY - 10 + 'px';
                    });
                    
                    circle.addEventListener('mouseleave', () => {
                        tooltip.style.opacity = '0';
                    });
                    
                    locationsGroup.appendChild(circle);
                }
            });

            // Add grid lines
            const gridLines = document.getElementById('gridLines');
            const gridSpacing = Math.max(10, Math.ceil((xMax - xMin) / 10));
            
            for (let i = 0; i <= Math.ceil((xMax - xMin) / gridSpacing); i++) {
                const x = scaleX(xMin + i * gridSpacing);
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('y1', 0);
                line.setAttribute('x2', x);
                line.setAttribute('y2', -plotHeight);
                line.setAttribute('class', 'grid-line');
                gridLines.appendChild(line);
            }

            for (let i = 0; i <= Math.ceil((yMax - yMin) / gridSpacing); i++) {
                const y = scaleY(yMin + i * gridSpacing);
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', 0);
                line.setAttribute('y1', y);
                line.setAttribute('x2', plotWidth);
                line.setAttribute('y2', y);
                line.setAttribute('class', 'grid-line');
                gridLines.appendChild(line);
            }

            updateStatistics(locations, xMin, xMax, yMin, yMax, filename);
        }

        function updateStatistics(locations, xMin, xMax, yMin, yMax, filename) {
            const customers = locations.filter(l => l.type === 'customer');
            const depot = locations.find(l => l.type === 'depot');
            
            const totalDemand = customers.reduce((sum, c) => sum + c.demand, 0);
            const allReadyTimes = customers.map(c => c.ready_time).filter(t => t < 9999);
            const allDueDates = customers.map(c => c.due_date).filter(t => t > 0);
            
            const minTime = allDueDates.length > 0 ? Math.min(...allDueDates) : 0;
            const maxTime = allReadyTimes.length > 0 ? Math.max(...allReadyTimes) : 0;

            document.getElementById('totalLocations').textContent = locations.length;
            document.getElementById('customersCount').textContent = customers.length;
            document.getElementById('depotLocation').textContent = `(${depot.x}, ${depot.y})`;
            document.getElementById('areaCoverage').textContent = `${Math.round(xMax - xMin)}√ó${Math.round(yMax - yMin)}`;
            document.getElementById('totalDemand').textContent = totalDemand.toFixed(1);
            document.getElementById('timeSpan').textContent = maxTime > minTime ? `${minTime}-${maxTime}` : 'N/A';
            document.getElementById('customerCount').textContent = `Customers (${customers.length} locations)`;
            
            // Update instance info
            if (filename) {
                const instanceName = filename.replace(/^jy_/, '').replace(/\.(txt|csv)$/, '').toUpperCase();
                const instanceType = filename.includes('_c') ? 'Clustered' : 
                                   filename.includes('_r') && !filename.includes('_rc') ? 'Random' : 
                                   filename.includes('_rc') ? 'Random-Clustered' : 'Custom';
                instanceInfo.innerHTML = `<strong>${instanceName}</strong> - ${instanceType} Instance (${customers.length} customers shown)`;
            } else {
                instanceInfo.innerHTML = `<strong>Custom Instance</strong> (${customers.length} customers shown)`;
            }
        }

        // State management
        let currentFileData = null;
        let currentFileName = null;

        async function processFile(file) {
            showLoading();
            
            try {
                const data = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = (e) => resolve(e.target.result);
                    reader.onerror = () => reject(new Error('File read error'));
                    reader.readAsText(file);
                });
                
                // Store file data for reprocessing when customer count changes
                currentFileData = data;
                currentFileName = file.name;
                
                // Get selected customer count
                const maxCustomers = parseInt(customerCountSelect.value);
                const locations = parseInstanceData(data, maxCustomers);
                
                createVisualization(locations, file.name);
                showVisualization();
                hideError();
                
            } catch (error) {
                console.error('Error processing file:', error);
                showError(`Failed to process file: ${error.message}`);
                hideVisualization();
            }
            
            hideLoading();
        }

        function reprocessCurrentFile() {
            if (currentFileData && currentFileName) {
                showLoading();
                
                try {
                    const maxCustomers = parseInt(customerCountSelect.value);
                    const locations = parseInstanceData(currentFileData, maxCustomers);
                    
                    createVisualization(locations, currentFileName);
                    showVisualization();
                    hideError();
                } catch (error) {
                    console.error('Error reprocessing file:', error);
                    showError(`Failed to reprocess file: ${error.message}`);
                    hideVisualization();
                }
                
                hideLoading();
            }
        }

        // Display control functions
        function showLoading() {
            loadingMessage.style.display = 'block';
            hideVisualization();
        }

        function hideLoading() {
            loadingMessage.style.display = 'none';
        }

        function showVisualization() {
            instanceInfo.style.display = 'block';
            plotContainer.style.display = 'block';
            legend.style.display = 'flex';
            stats.style.display = 'grid';
        }

        function hideVisualization() {
            instanceInfo.style.display = 'none';
            plotContainer.style.display = 'none';
            legend.style.display = 'none';
            stats.style.display = 'none';
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.style.display = 'block';
        }

        function hideError() {
            errorMessage.style.display = 'none';
        }

        // Event listeners
        uploadZone.addEventListener('click', (e) => {
            // Don't trigger file input if clicking on the dropdown
            if (e.target === customerCountSelect || customerCountSelect.contains(e.target)) {
                return;
            }
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                processFile(e.target.files[0]);
            }
        });

        customerCountSelect.addEventListener('change', () => {
            reprocessCurrentFile();
        });

        // Drag and drop functionality
        uploadZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadZone.classList.add('dragover');
        });

        uploadZone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
        });

        uploadZone.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                processFile(files[0]);
            }
        });
    </script>
</body>
</html>
